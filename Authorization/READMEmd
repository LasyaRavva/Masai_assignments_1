# Authorization-Based TODO Application

A secure TODO application built with Node.js, Express, Supabase, and JWT-based Authorization.

## Features

✅ User Authentication (Signup & Login)  
✅ JWT-based Authorization  
✅ Protected TODO CRUD Operations  
✅ User-specific TODO Management  
✅ Password Hashing with bcrypt  
✅ Ownership Validation  

## Tech Stack

- **Backend**: Node.js, Express.js
- **Database**: Supabase (PostgreSQL)
- **Authentication**: JWT (JSON Web Tokens)
- **Password Hashing**: bcryptjs

## Project Structure

```
Authorization/
├── config/
│   └── supabase.js           # Supabase client configuration
├── controllers/
│   ├── authController.js     # Authentication logic
│   └── todoController.js     # TODO CRUD operations
├── middleware/
│   ├── auth.middleware.js    # JWT verification middleware
│   └── validation.js         # Input validation
├── routes/
│   ├── auth.routes.js        # Authentication routes
│   └── todo.routes.js        # TODO routes (protected)
├── .env.example              # Environment variables template
├── .gitignore
├── package.json
├── README.md
└── server.js                 # Application entry point
```

## Database Setup

### 1. Create Supabase Tables

#### Users Table
```sql
CREATE TABLE users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### Todos Table
```sql
CREATE TABLE todos (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  title VARCHAR(500) NOT NULL,
  completed BOOLEAN DEFAULT FALSE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create index for better query performance
CREATE INDEX idx_todos_user_id ON todos(user_id);
```

## Installation & Setup

### 1. Clone the repository
```bash
git clone <your-repo-url>
cd Authorization
```

### 2. Install dependencies
```bash
npm install
```

### 3. Configure Environment Variables
Create a `.env` file in the root directory:
```env
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
JWT_SECRET=your_jwt_secret_key_here
PORT=3000
```

**To generate a secure JWT secret:**
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### 4. Run the application

**Development mode:**
```bash
npm run dev
```

**Production mode:**
```bash
npm start
```

Server will start at `http://localhost:3000`

## API Endpoints

### Authentication Endpoints

#### 1. User Signup
**POST** `/api/signup`

**Request Body:**
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123"
}
```

**Response (201):**
```json
{
  "message": "User registered successfully",
  "user": {
    "name": "John Doe",
    "email": "john@example.com"
  }
}
```

#### 2. User Login
**POST** `/api/login`

**Request Body:**
```json
{
  "email": "john@example.com",
  "password": "password123"
}
```

**Response (200):**
```json
{
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "name": "John Doe",
    "email": "john@example.com"
  }
}
```

**Token expiry:** 1 hour

---

### TODO Endpoints (Protected)

**All TODO routes require JWT token in headers:**
```
Authorization: Bearer <your_jwt_token>
```

#### 1. Create Todo
**POST** `/api/todos`

**Headers:**
```
Authorization: Bearer <token>
```

**Request Body:**
```json
{
  "title": "Complete project documentation",
  "completed": false
}
```

**Response (201):**
```json
{
  "message": "Todo created successfully",
  "todo": {
    "id": "uuid",
    "title": "Complete project documentation",
    "completed": false,
    "user_id": "user_uuid",
    "created_at": "2026-02-02T10:30:00Z"
  }
}
```

#### 2. Get All Todos (User-specific)
**GET** `/api/todos`

**Headers:**
```
Authorization: Bearer <token>
```

**Response (200):**
```json
{
  "todos": [
    {
      "id": "uuid",
      "title": "Complete project documentation",
      "completed": false,
      "user_id": "user_uuid",
      "created_at": "2026-02-02T10:30:00Z"
    }
  ],
  "count": 1
}
```

#### 3. Update Todo
**PUT** `/api/todos/:id`

**Headers:**
```
Authorization: Bearer <token>
```

**Request Body:**
```json
{
  "title": "Updated todo title",
  "completed": true
}
```

**Response (200):**
```json
{
  "message": "Todo updated successfully",
  "todo": {
    "id": "uuid",
    "title": "Updated todo title",
    "completed": true,
    "user_id": "user_uuid",
    "created_at": "2026-02-02T10:30:00Z"
  }
}
```

#### 4. Delete Todo
**DELETE** `/api/todos/:id`

**Headers:**
```
Authorization: Bearer <token>
```

**Response (200):**
```json
{
  "message": "Todo deleted successfully"
}
```

## Authorization Rules

- ✅ All TODO routes require valid JWT token
- ✅ Users can only access their own todos
- ✅ `userId` is automatically extracted from JWT (not from request body)
- ✅ Ownership validation before update/delete operations
- ✅ Proper HTTP status codes for all scenarios

## HTTP Status Codes

| Code | Description |
|------|-------------|
| 200  | Success |
| 201  | Created |
| 400  | Bad Request (validation error) |
| 401  | Unauthorized (invalid/missing token) |
| 403  | Forbidden (access denied) |
| 404  | Not Found |
| 409  | Conflict (duplicate email) |
| 500  | Internal Server Error |

## Error Responses

All errors follow this format:
```json
{
  "error": "Error message here"
}
```

## Security Features

1. **Password Hashing**: All passwords are hashed using bcrypt (10 salt rounds)
2. **JWT Authentication**: Tokens expire after 1 hour
3. **Authorization Middleware**: Validates token on every protected route
4. **Ownership Validation**: Users can only modify their own todos
5. **Input Validation**: All inputs are validated before processing
6. **Environment Variables**: Sensitive data stored in `.env` file

## Testing the API

### Using cURL

**Signup:**
```bash
curl -X POST http://localhost:3000/api/signup \
  -H "Content-Type: application/json" \
  -d '{"name":"John Doe","email":"john@example.com","password":"password123"}'
```

**Login:**
```bash
curl -X POST http://localhost:3000/api/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}'
```

**Create Todo:**
```bash
curl -X POST http://localhost:3000/api/todos \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{"title":"My first todo"}'
```

**Get Todos:**
```bash
curl -X GET http://localhost:3000/api/todos \
  -H "Authorization: Bearer <your_token>"
```

### Using Postman or Thunder Client

1. Import the endpoints into your API client
2. For protected routes, add header: `Authorization: Bearer <token>`
3. Test all CRUD operations

## Development

**Watch mode with nodemon:**
```bash
npm run dev
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

MIT

## Author

Built as part of Masai School assignments.

---

**Note:** Make sure to set up your Supabase database and configure environment variables before running the application.